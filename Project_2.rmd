---
title: "Project_2"
author: "Dillon Hong"
date: "3/16/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

## Data Cleaning and Exploration

```{r}
library(gmodels)
library(class)
library(caret)
hotel <- read.csv("hotel_booking.csv")
hotel$arrival_date_week_number <- as.factor(hotel$arrival_date_week_number)
hotel$agent <- ifelse(is.na(hotel$agent), -1, hotel$agent)
hotel$agent <- as.factor(hotel$agent)
hotel$company <- ifelse(is.na(hotel$company), -1, hotel$company)
hotel$company <- as.factor(hotel$company)

# Delete Unnecessary Columns

hotel$name <- NULL
hotel$email <- NULL
hotel$phone_number <- NULL
hotel$credit_card <- NULL
hotel$arrival_date_year <- NULL
hotel$arrival_date_week_number <- NULL
hotel$arrival_date_day_of_month <- NULL


hotel <- subset(hotel, hotel == "City Hotel")
hotel$hotel <- NULL
head(hotel, 200)
```


### Check for NAs
```{r}
cbind(
   lapply(
     lapply(hotel, is.na)
     , sum)
   )
```



### Remove NAs from Children Column
```{r}
# Checking for NA values in all of the column data
hotel$children <- ifelse(is.na(hotel$children), median(hotel$children, na.rm = TRUE), hotel$children)

cbind(
   lapply(
     lapply(hotel, is.na)
     , sum)
   )
```


### Randomize and Factorize Data 
```{r}
# Randomize the rows in the data (shuffling the rows)
set.seed(12345)
hotel_random <- hotel[sample(nrow(hotel)),]

hotel_random$arrival_date_month <- as.factor(hotel_random$arrival_date_month)
hotel_random$meal <- as.factor(hotel_random$meal)
hotel_random$country <- as.factor(hotel_random$country)
hotel_random$market_segment <- as.factor(hotel_random$market_segment)
hotel_random$distribution_channel <- as.factor(hotel_random$distribution_channel)
hotel_random$reserved_room_type <- as.factor(hotel_random$reserved_room_type)
hotel_random$assigned_room_type <- as.factor(hotel_random$assigned_room_type)
hotel_random$deposit_type <- as.factor(hotel_random$deposit_type)
hotel_random$customer_type <- as.factor(hotel_random$customer_type)
hotel_random$reservation_status <- as.factor(hotel_random$reservation_status)

library(class)

# Randomize again for good measure
hotel_random <- hotel[sample(nrow(hotel)),]
```



# Normalized Data
```{r}
#get rid of factors so we can use KNN
hotelDummy <- as.data.frame(model.matrix (~ . -1, data = hotel_random))
str(hotelDummy)

#Normalize the data
normalize <- function(x) {
  return ((x - min(x)) / (max(x) - min(x)))
}

#Normalize entire dataframe
hotel_norm <- as.data.frame(lapply(hotelDummy, normalize))
str(hotel_norm)
summary(hotel_norm)
```



## Linear Regression Model

### Train and Test Dataset
```{r}
test_set <- sample(1:nrow(hotel_random), 0.3*nrow(hotel_random))

hotel_train <- hotel_random[-test_set, ]
hotel_test <- hotel_random[test_set, ]

#Now the response (aka Labels) - only the yyes column
hotel_train_labels <- hotel_random[-test_set, "is_canceled"]
hotel_test_labels <- hotel_random[test_set, "is_canceled"]

```

### Model
```{r}
#Ryan
#best r squared and most significant variables
model <- glm(is_canceled ~ lead_time +  stays_in_week_nights +  adr  , data = hotel)
summary(model)


```



## KNN Model 

### Train and Test Dataset
```{r}
hotel_norm_train <- hotel_norm[-test_set, -match("is_canceled",names(hotel_norm))]
hotel_norm_test <- hotel_norm[test_set, -match("is_canceled",names(hotel_norm))]

#Now the response (aka Labels)
hotel_norm_train_labels <- hotel_norm[-test_set, "is_canceled"]
hotel_norm_test_labels <- hotel_norm[test_set, "is_canceled"]
```


```{r}
cbind(
   lapply(
     lapply(hotel_norm_train, is.na)
     , sum)
   )
```



### Model
```{r}
# Download Library 
library(class)

hotel_knn <- knn(train = hotel_norm_train[,-1], test = hotel_norm_test[, -1], cl = hotel_norm_train_labels$is_canceled, k = (sqrt(nrow(hotel_norm_train))))


```

## ANN Model 


### Train and Test Dataset
```{r}
hotel_norm_train <- hotel_norm[-test_set, ]
hotel_norm_test <- hotel_norm[test_set, ]

#Now the response (aka Labels) - only the yyes column
hotel_norm_train_labels <- hotel_norm[-test_set, "is_canceled"]
hotel_norm_test_labels <- hotel_norm[test_set, "is_canceled"]
```

###Model
```{r}
library(neuralnet)

hotel_ann <- neuralnet(formula = is_canceled ~ .,data = hotel_norm)




annprediction <- predict(hotel_ann, hotel_norm, type="response")
factorize_ann_prediction <- as.factor(ifelse(annprediction>0.5,1,0))

ann_confusionmaxtrix <- confusionMatrix(as.factor(factorize_ann_prediction), as.factor(hotel_norm$is_canceled))
ann_confusionmaxtrix

```

##SVM

###Train and Test Datasets
```{r}
hotel_train <- hotel_random[-test_set, ]
hotel_test <- hotel_random[test_set, ]
```


### Model #1
```{r}
library(kernlab)

cancellation_classifier <- ksvm(is_canceled ~ ., data = hotel_train, kernel = "vanilladot")
```



```{r}
cancellation_predictions <- predict(cancellation_classifier, hotel_test[, -1])

head(cancellation_predictions)

table(cancellation_predictions, hotel_test$is_canceled)

# look only at agreement vs. non-agreement
# construct a vector of TRUE/FALSE indicating correct/incorrect predictions
agreement <- cancellation_predictions == hotel_test$is_canceled
table(agreement)
prop.table(table(agreement))

```


```{r}
svm_model2 <- ksvm(ChurnYes ~ ., data = telco_random, kernel = "rbfdot")
```

##Decision Tree

###Train and Test Datasets
```{r}
hotel_train <- hotel_random[-test_set, ]
hotel_test <- hotel_random[test_set, ]
```

###Model
```{r}


```


##Stacked Model

```{r}



```


##Conclusion
